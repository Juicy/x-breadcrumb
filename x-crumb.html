<link rel="import" href="../polymer/polymer.html">

<dom-module id="x-crumb">
    <template>
        <style>
            :host {
                display: block;
                max-height: 600px;
            }

            label {
                margin: 4px;
                color: white;
                text-decoration: none;
                padding: 10px 30px 10px 45px;
                position: relative;
                display: block;
                z-index: 1;
                background: rgba(128, 128, 128,0);
            }

            label::after {
                content: " ";
                display: block;
                width: 90%;
                height: 50%;
                position: absolute;
                top: 0px;
                left: 0px;
                z-index: -1;
                background: rgba(128, 128, 128,1);
                -webkit-transform: skewX(35deg);
                transform: skewX(35deg);
            }

            label::before {
                content: " ";
                display: block;
                width: 90%;
                height: 50%;
                position: absolute;
                bottom: 0px;
                left: 0px;
                z-index: -1;
                background: rgba(128, 128, 128,1);
                -webkit-transform: skewX(-35deg);
                transform: skewX(-35deg);
            }

            label[active] {
                background: rgba(53,122,232,0);
            }

            label[active]::before {
                background: rgba(31, 109, 255,0.4);
            }

            label[active]::after {
                background: rgba(31, 109, 255,0.4);
            }

            label[ghost] {
                background: rgba(128,128,128,0);
            }

            label[ghost]::before {
                background: rgba(128,128,128,0.5);
            }

            label[ghost]::after {
                background: rgba(128,128,128,0.5);
            }

            .options {
                height: 0;
                background: rgba(128, 128, 128, 0.9);
                position: absolute;
                display: none;
                width: 90%;
                height: 250px;
                transition: top 300ms cubic-bezier(0.17, 0.04, 0.03, 0.94);
                overflow: hidden;
                box-sizing: border-box;
                padding: 5px;
                z-index: 10;
            }

            .search {
                width: 100%;
                text-align: center;
                padding: 5px;
                font-size: smaller;
                box-sizing: border-box;
            }

            .options[expanded] {
                height: auto;
                display: block;
                min-height: 40px;
                max-height: 400px;
            }
        </style>
        <label active$="[[active]]" ghost$="[[ghost]]" on-click="expandDropdown" on-mouseover="onItemHover" on-mouseout="onItemBlur"><span>[[value]]</span> &nbsp; &#x2228;</label>
        <div class="options" expanded$="[[expanded]]">
            <input on-click="preventCollapse" type="text" value="{{searchQuery::input}}" class="search" placeholder="Search">
            <content></content>
        </div>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'x-crumb',

                properties: {
                    dropdown: {
                        type: Boolean,
                        value: true,
                        notify: true
                    },
                    expanded: {
                        type: Boolean,
                        value: false,
                        notify: true,
                        reflectToAttribute: true
                    },
                    ghost: {
                        type: Boolean,
                        value: false,
                        notify: true
                    },
                    active: {
                        type: Boolean,
                        value: false,
                        notify: true
                    },
                    searchQuery: {
                        type: String,
                        value: "",
                        notify: true
                    },
                    alloptions: {
                        type: Array,
                        value: [],
                        notify: true
                    },
                    add: {
                        type: Boolean,
                        value: false,
                        notify: true
                    }
                },
                attached: function () {
                    this.set("expanded", false);
                    document.body.addEventListener("click", function (e) {
                        setTimeout(function () {
                            if (this.hovered) {
                                return;
                            }

                            this.set("expanded", false);
                        }.bind(this), 100);
                    }.bind(this));
                },
                preventCollapse: function(ev) {
                    ev.stopPropagation();
                },
                expandDropdown: function (e) {
                    this.set("expanded", true);
                    e.preventDefault();
                },
                onItemHover: function () {
                    this.hovered = true;
                },
                onItemBlur: function () {
                    this.hovered = false;
                },
                value: function () { }
            });
        })();
    </script>
</dom-module>
